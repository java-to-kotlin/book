#!/bin/sh
set -e

if [ "$1" = "--for-real" ]
then
 echo "for real" 1>&2
 cmd="git"
else
 echo "dry run" 1>&2
 cmd="echo git"
fi

cd ../refactoring-to-kotlin-code

git log --format=oneline | awk '
    /[0-9a-f]{32} r([0-9]+) :/ {
      linerev = substr($2,2) + 0 # force a numeric comparison
      if (linerev != rev) {
         if (rev != "" && linerev >= rev) {
           print "revision out of order:",$0 > "/dev/stderr"
           exit 1
         }

         rev = linerev
         print $2, $1
      }
    }
' | xargs -n 2 $cmd tag -a -m "tag generated automatically by retag-worked-example script" -f
